import datetime
from dateutil import tz
import pytest

from forest.oak.base import preprocess_dates


@pytest.fixture
def sample_file_list():
    return [
        '2023-11-01 00_00_00+00_00.csv', '2023-11-01 01_00_00+00_00.csv',
        '2023-11-01 02_00_00+00_00.csv', '2023-11-01 03_00_00+00_00.csv',
        '2023-11-01 04_00_00+00_00.csv', '2023-11-01 05_00_00+00_00.csv',
        '2023-11-01 06_00_00+00_00.csv', '2023-11-01 07_00_00+00_00.csv',
        '2023-11-01 08_00_00+00_00.csv', '2023-11-01 09_00_00+00_00.csv',
        '2023-11-01 10_00_00+00_00.csv', '2023-11-01 11_00_00+00_00.csv',
        '2023-11-01 12_00_00+00_00.csv', '2023-11-01 13_00_00+00_00.csv',
        '2023-11-01 14_00_00+00_00.csv', '2023-11-01 15_00_00+00_00.csv',
        '2023-11-01 16_00_00+00_00.csv', '2023-11-01 17_00_00+00_00.csv',
        '2023-11-01 18_00_00+00_00.csv', '2023-11-01 19_00_00+00_00.csv',
        '2023-11-01 20_00_00+00_00.csv', '2023-11-01 21_00_00+00_00.csv',
        '2023-11-01 22_00_00+00_00.csv', '2023-11-01 23_00_00+00_00.csv',
        '2023-11-02 00_00_00+00_00.csv', '2023-11-02 01_00_00+00_00.csv',
        '2023-11-02 02_00_00+00_00.csv', '2023-11-02 03_00_00+00_00.csv',
        '2023-11-02 04_00_00+00_00.csv', '2023-11-02 05_00_00+00_00.csv',
        '2023-11-02 06_00_00+00_00.csv', '2023-11-02 07_00_00+00_00.csv',
        '2023-11-02 08_00_00+00_00.csv', '2023-11-02 09_00_00+00_00.csv',
        '2023-11-02 10_00_00+00_00.csv', '2023-11-02 11_00_00+00_00.csv',
        '2023-11-02 12_00_00+00_00.csv', '2023-11-02 13_00_00+00_00.csv',
        '2023-11-02 14_00_00+00_00.csv', '2023-11-02 15_00_00+00_00.csv',
        '2023-11-02 16_00_00+00_00.csv', '2023-11-02 17_00_00+00_00.csv',
        '2023-11-02 18_00_00+00_00.csv', '2023-11-02 19_00_00+00_00.csv',
        '2023-11-02 20_00_00+00_00.csv', '2023-11-02 21_00_00+00_00.csv',
        '2023-11-02 22_00_00+00_00.csv', '2023-11-02 23_00_00+00_00.csv',
        '2023-11-03 00_00_00+00_00.csv', '2023-11-03 01_00_00+00_00.csv',
        '2023-11-03 02_00_00+00_00.csv', '2023-11-03 03_00_00+00_00.csv',
        '2023-11-03 04_00_00+00_00.csv', '2023-11-03 05_00_00+00_00.csv',
        '2023-11-03 06_00_00+00_00.csv', '2023-11-03 07_00_00+00_00.csv',
        '2023-11-03 08_00_00+00_00.csv', '2023-11-03 09_00_00+00_00.csv',
        '2023-11-03 10_00_00+00_00.csv', '2023-11-03 11_00_00+00_00.csv',
        '2023-11-03 12_00_00+00_00.csv', '2023-11-03 13_00_00+00_00.csv',
        '2023-11-03 14_00_00+00_00.csv', '2023-11-03 15_00_00+00_00.csv',
        '2023-11-03 16_00_00+00_00.csv', '2023-11-03 17_00_00+00_00.csv',
        '2023-11-03 18_00_00+00_00.csv', '2023-11-03 19_00_00+00_00.csv',
        '2023-11-03 20_00_00+00_00.csv', '2023-11-03 21_00_00+00_00.csv',
        '2023-11-03 22_00_00+00_00.csv', '2023-11-03 23_00_00+00_00.csv',
        '2023-11-04 00_00_00+00_00.csv', '2023-11-04 01_00_00+00_00.csv',
        '2023-11-04 02_00_00+00_00.csv', '2023-11-04 03_00_00+00_00.csv',
        '2023-11-04 04_00_00+00_00.csv', '2023-11-04 05_00_00+00_00.csv',
        '2023-11-04 06_00_00+00_00.csv', '2023-11-04 07_00_00+00_00.csv',
        '2023-11-04 08_00_00+00_00.csv', '2023-11-04 09_00_00+00_00.csv',
        '2023-11-04 10_00_00+00_00.csv', '2023-11-04 11_00_00+00_00.csv',
        '2023-11-04 12_00_00+00_00.csv', '2023-11-04 13_00_00+00_00.csv',
        '2023-11-04 14_00_00+00_00.csv', '2023-11-04 15_00_00+00_00.csv',
        '2023-11-04 16_00_00+00_00.csv', '2023-11-04 17_00_00+00_00.csv',
        '2023-11-04 18_00_00+00_00.csv', '2023-11-04 19_00_00+00_00.csv',
        '2023-11-04 20_00_00+00_00.csv', '2023-11-04 21_00_00+00_00.csv',
        '2023-11-04 22_00_00+00_00.csv', '2023-11-04 23_00_00+00_00.csv',
        '2023-11-05 00_00_00+00_00.csv', '2023-11-05 01_00_00+00_00.csv',
        '2023-11-05 02_00_00+00_00.csv', '2023-11-05 03_00_00+00_00.csv',
        '2023-11-05 04_00_00+00_00.csv', '2023-11-05 05_00_00+00_00.csv',
        '2023-11-05 06_00_00+00_00.csv', '2023-11-05 07_00_00+00_00.csv',
        '2023-11-05 08_00_00+00_00.csv', '2023-11-05 09_00_00+00_00.csv',
        '2023-11-05 10_00_00+00_00.csv', '2023-11-05 11_00_00+00_00.csv',
        '2023-11-05 12_00_00+00_00.csv', '2023-11-05 13_00_00+00_00.csv',
        '2023-11-05 14_00_00+00_00.csv', '2023-11-05 15_00_00+00_00.csv',
        '2023-11-05 16_00_00+00_00.csv', '2023-11-05 17_00_00+00_00.csv',
        '2023-11-05 18_00_00+00_00.csv', '2023-11-05 19_00_00+00_00.csv',
        '2023-11-05 20_00_00+00_00.csv', '2023-11-05 21_00_00+00_00.csv',
        '2023-11-05 22_00_00+00_00.csv', '2023-11-05 23_00_00+00_00.csv',
        '2023-11-06 00_00_00+00_00.csv', '2023-11-06 01_00_00+00_00.csv',
        '2023-11-06 02_00_00+00_00.csv', '2023-11-06 03_00_00+00_00.csv',
        '2023-11-06 04_00_00+00_00.csv', '2023-11-06 05_00_00+00_00.csv',
        '2023-11-06 06_00_00+00_00.csv', '2023-11-06 07_00_00+00_00.csv',
        '2023-11-06 08_00_00+00_00.csv', '2023-11-06 09_00_00+00_00.csv',
        '2023-11-06 10_00_00+00_00.csv', '2023-11-06 11_00_00+00_00.csv',
        '2023-11-06 12_00_00+00_00.csv', '2023-11-06 13_00_00+00_00.csv',
        '2023-11-06 14_00_00+00_00.csv', '2023-11-06 15_00_00+00_00.csv',
        '2023-11-06 16_00_00+00_00.csv', '2023-11-06 17_00_00+00_00.csv',
        '2023-11-06 18_00_00+00_00.csv', '2023-11-06 19_00_00+00_00.csv',
        '2023-11-06 20_00_00+00_00.csv', '2023-11-06 21_00_00+00_00.csv',
        '2023-11-06 22_00_00+00_00.csv', '2023-11-06 23_00_00+00_00.csv'
    ]


def test_preprocess_dates_length(sample_file_list):
    """Test preprocess_dates function for length of output list"""
    time_start = None
    time_end = None
    fmt = "%Y-%m-%d %H_%M_%S"
    from_zone = tz.gettz("UTC")
    to_zone = tz.gettz("America/New_York")

    dates_shifted, _, _ = preprocess_dates(
        sample_file_list, time_start, time_end, fmt, from_zone, to_zone
    )
    assert len(dates_shifted) == 144


def test_preprocess_dates_start_end_dates(sample_file_list):
    """Test preprocess_dates function for start/end date"""
    time_start = None
    time_end = None
    fmt = "%Y-%m-%d %H_%M_%S"
    from_zone = tz.gettz("UTC")
    to_zone = tz.gettz("America/New_York")

    _, date_start, date_end = preprocess_dates(
        sample_file_list, time_start, time_end, fmt, from_zone, to_zone
    )
    assert date_start == datetime.datetime(2023, 10, 31, 0, 0, tzinfo=to_zone)
    assert date_end == datetime.datetime(2023, 11, 6, 0, 0, tzinfo=to_zone)


def test_preprocess_dates_start_end_dates_inputs(sample_file_list):
    """Test preprocess_dates function for start/end date, with inputs"""
    time_start = "2023-10-31 00_00_00"
    time_end = "2023-11-03 00_00_00"
    fmt = "%Y-%m-%d %H_%M_%S"
    from_zone = tz.gettz("UTC")
    to_zone = tz.gettz("America/New_York")

    _, date_start, date_end = preprocess_dates(
        sample_file_list, time_start, time_end, fmt, from_zone, to_zone
    )
    assert date_start == datetime.datetime(2023, 10, 30, 0, 0, tzinfo=to_zone)
    assert date_end == datetime.datetime(2023, 11, 2, 0, 0, tzinfo=to_zone)
